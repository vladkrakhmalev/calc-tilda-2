
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=9d0d93e9-f2e9-49cf-bb90-40c66d1ecdf4" type="text/javascript"></script>

  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

  <style>
    body {margin: 0;}

    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap');

.k-calc *,
.k-calc {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
.k-calc p,
.k-calc a,
.k-calc div {
  font-family: 'Roboto', sans-serif;
}
.k-calc__section {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 35px;
  max-width: 1260px;
  padding: 0 30px;
  margin: 50px auto;
}
.k-map {
  width: 100%;
  height: 100% !important;
}
.k-calc {
  max-width: 600px;
  width: 100%;
  background: #FFFFFF;
  box-shadow: 0px 9px 40px rgba(0, 0, 0, 0.25);
  border-radius: 30px;
  padding: 25px;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 20px;
}
.k-calc__title {
  font-weight: 500;
  font-size: 23px;
  line-height: 27px;
  text-align: center;
  grid-column: span 4;
}
.k-calc__subtitle {
  font-size: 17px;
  line-height: 20px;
  grid-column: span 4;
}
.k-calc__weight-input {
    display:none;
}
.k-calc__weight-text {
  font-size: 15px;
  line-height: 18px;
  width: 100%;
  border: 1px solid rgba(0, 0, 0, 0.29);
  border-radius: 5px;
  padding: 11px;
  text-align: center;
  transition: .3s;
  cursor: pointer;
  font-family: 'Roboto', sans-serif;
}
.k-calc__weight-input:checked + .k-calc__weight-text,
.k-calc__weight-text:hover {
  border: 1px solid #0056D3;
}
.k-calc__field {
  grid-column: span 2;
  border: 1px solid rgba(0, 0, 0, 0.29);
  padding: 11px;
}
.k-calc__input {
  display: block;
  min-width: 200px;
  width: 100%;
  outline: none;
  border: none;
  box-shadow: inset 0 0 0 30px #fff;
}
.k-calc__field._place,
.k-calc__field._tel {
  padding-left: 34px;
  background-repeat: no-repeat;
  background-position: top 50% left 7px;
  background-size: 19px;
}
.k-calc__field._place {
  background-image: url('http://vladkrda.beget.tech/img/i_place.png');
}
.k-calc__field._tel {
  background-image: url('http://vladkrda.beget.tech/img/i_tel.png');
}
.k-calc__checkbox {
  display: grid;
  grid-template-columns: 18px max-content;
  grid-gap: 8px;
  grid-column: span 4;
  cursor: pointer;
  width: max-content;
}
.k-calc__checkbox-check {
  border: 1px solid rgba(0, 0, 0, 0.5);
  box-sizing: border-box;
  border-radius: 4px;
  width: 18px;
  height: 18px;
  background-repeat: no-repeat;
  background-size: 14px;
  background-position: center;
  transition: .3s;
}
.k-calc__checkbox-input {
  display: none;
}
.k-calc__checkbox-input:checked + .k-calc__checkbox-check {
  background-image: url('http://vladkrda.beget.tech/img/i_check.png');
}
.k-calc__checkbox-text {
  user-select: none;
}
.k-calc__wrapper {
  grid-column: span 4;
  display: flex;
  flex-wrap: wrap;
  grid-gap: 10px;
  align-items: center;
}
.k-calc__list {
  grid-column: span 4;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  grid-gap: 10px;
}
.k-calc__item {
  font-size: 16px;
  line-height: 19px;
  color: #0056D3;
  cursor: pointer;
  transition: .25s;
}
.k-calc__item:hover {
  color: #053C8D;
}
.k-calc__info {
  width: 14px;
  height: 19px;
  background-image: url('http://vladkrda.beget.tech/img/i_info.png');
  background-repeat: no-repeat;
  background-size: contain;
  background-position: center;
  position: relative;
  user-select: none;
}
.k-calc__info-text {
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translate(5px,-50%);
  width: max-content;
  max-width: 300px;
  background-color: #fff;
  padding: 10px;
  box-shadow: 0 0 10px #00000022;
  border-radius: 5px;
  user-select: none;
  opacity: 0;
  z-index: -1;
  font-size: 12px;
}
.k-calc__info:hover .k-calc__info-text {
  z-index: 1;
  opacity: 1;
}
.k-calc__label {
  font-size: 15px;
  line-height: 18px;
  color: rgba(0, 0, 0, 0.5);
}
.k-calc__price {
  grid-column: span 4;
  font-size: 17px;
  line-height: 20px;
  border: none;
  display: block;
  outline: none;
}
.k-calc__btn {
  grid-column: span 2;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.25);
  border-radius: 10px;
  background: #0056D3;
  border: 1px solid rgba(0, 0, 0, 0.29);
  font-size: 17px;
  line-height: 20px;
  color: #FFFFFF;
  padding: 15px 30px;
  cursor: pointer;
  transition: .25s;
}
.k-calc__btn:hover {
  background: #053C8D;
}
.k-calc__btn[disabled] {
    background: #ccc !important;
    border: none;
    box-shadow: none;
}
#map {
  margin: auto 0 0 0;
  height: 65% !important;
}

@media (max-width: 1200px) {
  .k-calc__input {
    min-width: auto;
  }
  .k-calc__list {
    justify-content: start;
  }
  .k-calc__btn {
    grid-column: 1/-1;
  }
}
@media (max-width: 960px) {
  .k-calc__weight {
    grid-column: span 2;
  }
  .k-calc__field {
    grid-column: 1/-1;
  }
}
@media (max-width: 720px) {
  .k-calc__section {
    grid-template-columns: 1fr;
  }
  .k-map {
    height: 300px !important;
  }
}
@media (max-width: 540px) {
  
}
  
  </style>

  <section class="k-calc__section">
    <form class="k-calc" data-dist="" id="k-calc">
      <p class="k-calc__title">Калькулятор расчета стоимости доставки</p>
      <p class="k-calc__subtitle">Укажите вес Вашей посылки:</p>


      <label class="k-calc__weight">
        <input type="radio" name="weight" value="0" class="k-calc__weight-input" checked>
        <div class="k-calc__weight-text">до 1 кг</div>
      </label>
      <label class="k-calc__weight">
        <input type="radio" name="weight" value="0" class="k-calc__weight-input">
        <div class="k-calc__weight-text">до 5 кг</div>
      </label>
      <label class="k-calc__weight">
        <input type="radio" name="weight" value="70" class="k-calc__weight-input">
        <div class="k-calc__weight-text">до 10 кг</div>
      </label>
      <label class="k-calc__weight">
        <input type="radio" name="weight" value="120" class="k-calc__weight-input">
        <div class="k-calc__weight-text">до 15 кг</div>
      </label>

      
      <div class="k-calc__field _place">
        <input type="text" name="place1" class="k-calc__input" id="place1" placeholder="Адрес отправки" required>
      </div>
      <div class="k-calc__field _tel">
        <input type="text" name="tel1" class="k-calc__input" placeholder="Телефон отправителя" required>
      </div>
      <div class="k-calc__field _place">
        <input type="text" name="place2" class="k-calc__input" id="place2" placeholder="Адрес доставки" required>
      </div>
      <div class="k-calc__field _tel">
        <input type="text" name="tel2" class="k-calc__input" placeholder="Телефон получателя" required>
      </div>


      <div class="k-calc__wrapper">
        <label class="k-calc__checkbox">
          <input class="k-calc__checkbox-input" type="checkbox" name="door">
          <div class="k-calc__checkbox-check"></div>
          <p class="k-calc__checkbox-text">До двери</p>
        </label>
        <div class="k-calc__info">
          <span>i</span>
          <span class="k-calc__info-text">Подъем на этаж/до двери и ожидание 15мин</span>
        </div>
      </div>


      <div class="k-calc__wrapper">
        <div class="k-calc__field">
          <input type="text" name="product" class="k-calc__input" placeholder="Что везем">
        </div>
        <label class="k-calc__checkbox">
          <input class="k-calc__checkbox-input" type="checkbox" name="fragility">
          <div class="k-calc__checkbox-check"></div>
          <p class="k-calc__checkbox-text">Хрупкое</p>
        </label>
      </div>
      <div class="k-calc__list">
        <div class="k-calc__item">Документы</div>
        <div class="k-calc__item">Продукты</div>
        <div class="k-calc__item">Одежда</div>
        <div class="k-calc__item">Посуда</div>
        <div class="k-calc__item">Цветы</div>
        <div class="k-calc__item">Другое</div>
      </div>


      <div class="k-calc__wrapper">
        <div class="k-calc__field">
          <input type="number" name="cost" class="k-calc__input" placeholder="Ценность посылки">
        </div>
        <div class="k-calc__info">
          <span>i</span>
          <span class="k-calc__info-text">Компенсируем ценность утерянных отправлений или выручки в течение трех рабочих дней. Максимальная компенсация — 75 000 руб.</span>
        </div>
        <div class="k-calc__label">плюс 0 ₽ к заказу</div>
      </div>


      <input class="k-calc__price" readonly value="Итого: XXX руб." name="price">
      <button class="k-calc__btn" type="submit">Отправить заказ</button>
    </form>
    <div id="map" class="k-map"></div>
  </section>
  
  <script>

    $('.k-calc__weight, .k-calc__checkbox').click(function() {
      calculate($('.k-calc').attr('data-dist'))
    })
    $('.k-calc__input[name="cost"]').on("input", function() {
      $(this).val(Math.min($(this).val(), 75000))
      calculate($('form.k-calc').attr('data-dist'))
    })


    let inputs = document.getElementsByClassName('k-calc__item')
    let input = document.querySelector('.k-calc__input[name="product"]')
    for (let i = 0; i < inputs.length; i++) {
        inputs[i].addEventListener("click", (e) => {
            input.value = e.target.textContent
            let dist = document.querySelector('form.k-calc').dataset.dist
            calculate(dist)
        })
    }

    ymaps.ready(init)

    function init() {

        //Create map
        var myMap = new ymaps.Map('map', {
            center: [42.983060, 47.504682],
            zoom: 8,
            controls: []
        })

        //Create placholder for input
        var object = 'Республика Дагестан'
        var myProvider = {
            suggest: (function(request) { return ymaps.suggest(object + ", " + request) })
        }
        var suggestView1 = new ymaps.SuggestView('place1', {provider: myProvider, results: 3})
        var suggestView2 = new ymaps.SuggestView('place2', {provider: myProvider, results: 3})

        //Create events for input
        suggestView1.events.add('select', () => {createRoute(myMap)})
        suggestView2.events.add('select', () => {createRoute(myMap)})

    }

    function createRoute(myMap) {
        
        let value1 = document.getElementById('place1').value
        let value2 = document.getElementById('place2').value
        let multiRoute

        if (value1 != '' && value2 != '') {

            multiRoute = new ymaps.multiRouter.MultiRoute({   
                referencePoints: [value1, value2]
            }, {
                boundsAutoApply: true
            })
            myMap.geoObjects.removeAll()
            myMap.geoObjects.add(multiRoute)
            multiRoute.model.setParams({results: 1}, true);
            multiRoute.model.events.add('requestsuccess', function() {
                var activeRoute = multiRoute.getActiveRoute()
                let distance = activeRoute.properties.get("distance")
                distance = Math.round(distance.value)
                distance = Math.round(distance / 1000)
                document.querySelector('form.k-calc').dataset.dist = distance
                calculate(Math.round(distance))
            })

        }

    }

    function calculate(distance) {
        let weight = Number($('.k-calc__weight-input:checked').val())
        let dist = Math.max(distance * 11, 150)
        let door = $('.k-calc__checkbox-input[name="door"]').prop('checked') ? 35 : 0
        let cost = Math.round($('.k-calc__input[name="cost"]').val() * 0.005)
        
        $('.k-calc__label').text('плюс ' + cost + ' ₽ к заказу')
        if ($('.k-calc__checkbox-input[name="fragility"]').prop('checked')) {
          cost = Math.round($('.k-calc__input[name="cost"]').val() * 0.008)
          $('.k-calc__label').text('плюс ' + cost + ' ₽ к заказу')
        }

        if ($('form.k-calc').attr('data-dist') != '') {
            let itog = weight + dist + door + cost
            $('.k-calc__price').val('Итого: ' + itog + ' руб.')
        }
    }

    $('#k-calc').on('submit', function(e) {
    e.preventDefault()
    let data = $(e.target).serialize()

    $.ajax({
        url: 'http://vladkrda.beget.tech/form.php',
        method: 'post',
        dataType: 'html',
        data: data,
        success: function (res) {
          let result = JSON.parse(res)
          if (result.success == "1") {
            $('.k-calc__btn').prop('disabled', true)
            $('.k-calc__btn').text('Данные отправлены')
          } else {
            ('.k-calc__btn').prop('disabled', true)
            $('.k-calc__btn').text('Ошибка, попробуйте позже')
          }
        }
    })

  })

  </script>
